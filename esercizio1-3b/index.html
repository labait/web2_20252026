<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&display=swap" rel="stylesheet">
          
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
    <script src="https://assets.incode.it/gsap-business/minified/SplitText.min.js"></script>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <style>
      body {
        font-family: 'DM Serif Text', serif;
      }

      h1 {
        font-size: 4vw;
        color: #cc0000;
      }

      #canvas1 {
          /* position: fixed;
          top: 0;
          left: 0; */
     
          pointer-events: none;
          z-index: 10;
      }
    </style>
    
  </head>
  <body>
    <section id="section1" class="flex items-center justify-center h-screen">
      <div class="title text-3xl font-bold underline text-center leading-tight">
        <div>La miglior vendetta? La felicità. </div>
        <div>Non c'è niente che faccia più impazzire </div>
        <div>la gente che vederti felice.</div>
      </div>
    </section>
    <section id="section2" class="h-screen bg-gray-200 flex items-center justify-center">
      <div class="title text-[4vw]">
        Scroll down to see the animation again.
      </div>
    </section>
    <section id="section3" class="h-screen bg-gray-400 flex items-center justify-center">
      <div class="text-3xl font-bold ">
     
         <div id="canvas1" class="w-full h-full border border-4"></div>
      </div>
    </section>

   

    <script type="module">
      //gsap.from("h1 div", {y: 200, opacity: 0, duration: 1, stagger: 0.1});
      gsap.from("#section1 .title div", {
        scrollTrigger: {
          trigger: "#section1",
          // start: "top center",
          // end: "bottom top",
          // toggleActions: "play none none reset",
          markers: true,
          scrub: true,
          pin: true,
        },
        y: 100,
        opacity: 0,
        duration: 1,
        stagger: 0.2,
      });

      gsap.from("#section2 .title", {
        scrollTrigger: {
          trigger: "#section2",
          // start: "top center",
          // end: "bottom top",
          // toggleActions: "play none none reset",
          markers: true,
          scrub: true,
          pin: true,
        },
        x: -800,
        opacity: 0,
        duration: 1,
      });

      
      import * as THREE from 'three';

      // Setup Scene
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.4, 1000);
      camera.position.z = 5;

      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x000000, 0);
      document.getElementById('canvas1').appendChild(renderer.domElement);

      // Funzione per centrare automaticamente un oggetto 3D nella scena
      function centerObjectInScene(object, camera) {
          // Calcola il bounding box dell'oggetto
          const box = new THREE.Box3().setFromObject(object);
          const center = box.getCenter(new THREE.Vector3());
          const size = box.getSize(new THREE.Vector3());

          // Centra l'oggetto spostandolo in modo che il suo centro sia all'origine
          object.position.x -= center.x;
          object.position.y -= center.y;
          object.position.z -= center.z;

          // Calcola la distanza necessaria per inquadrare l'oggetto
          const maxDim = Math.max(size.x, size.y, size.z);
          const fov = camera.fov * (Math.PI / 180);
          let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
          
          // Aggiungi un po' di spazio extra per non avere l'oggetto troppo vicino
          cameraZ *= 1.5;
          
          // Posiziona la camera per inquadrare l'oggetto
          camera.position.z = cameraZ;
          camera.lookAt(0, 0, 0);
      }

      // Crea un oggetto 3D (cubo con materiale colorato)
      const geometry = new THREE.BoxGeometry(2, 2, 2);
      const material = new THREE.MeshStandardMaterial({
          color: 0xff0000,
          metalness: 0.5,
          roughness: 0.2,
          transparent: true,
          opacity: 0.9
      });
      const cube = new THREE.Mesh(geometry, material);
      scene.add(cube);

      // Centra automaticamente il cubo nella scena
      centerObjectInScene(cube, camera);

      // Luci
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      directionalLight.position.set(5, 5, 5);
      scene.add(directionalLight);

      // Animazione di rotazione continua
      function animate() {
          requestAnimationFrame(animate);
          cube.rotation.x += 0.01;
          cube.rotation.y += 0.01;
          renderer.render(scene, camera);
      }
      animate();  


      /*  */
      // GSAP ScrollTrigger Animation
      gsap.registerPlugin(ScrollTrigger);

      gsap.to(cube.position, {
          x: 10, // Muove da -10 (sinistra) a 10 (destra)
          ease: "none",
          scrollTrigger: {
              trigger: "#section3",
              start: "top top",
              end: "bottom top",
              scrub: true,
              pin: true,
              markers: true // Imposta a true per vedere i marker di debug
          }
      });

      // Gestione resize
      window.addEventListener('resize', () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
      });

   
    </script>
  </body>
</html>